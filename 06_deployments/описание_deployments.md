# Deployments

Под копотом deployments это тот же самый `replicaSet`, но тут смысл в том что, `replicaSet` упарвляет Подами, а deployment управляет `replicaSet'ами`.

> Фактически при создании `deployments`, мы создаем `ReplicaSet'ы` и всеми ресурсами будет управлять `ReplicaSet'ы`, а не `Deployments`

Создавая `deployments` добавляем флаг `--record`, что бы записывались ревизии.

При изменении уже зааттаченного `DEployment` объекта в кубере, `Deployment` органично подходит к изменениям подов. Т.е. он создает новую `ReplicaSet`, создает новые метки, по которым `ReplicaSet` будет следить за новыми подами, а старая `ReplicaSet` начинает удалять поды за которыми она до этого следила. При этом старая `ReplicaSet` сразу не удаляется ( и нам вручную их удалять тоже не надо ), она нужна для того что бы можно было откатиться в случае чего к старой ревизии (версии) через команду:

`kubectl rollout undo deployment {{назваеие-deployment}}`

--- 

Посмотреть список ревизий (версий):

`kubectl rollout history deployment {{название-deployment}}`

![список ревизий](./%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%80%D0%B5%D0%B2%D0%B8%D0%B7%D0%B8%D0%B9.png)

---

Откатиться к определенной ревизии (версии):

`kubectl rollout undo deployment {{название-deployment}} --to-revision=1`

---

При создании `deployment` создается `replicaSet` с названием: `{{название-deployment}}-{{хэш-который-создаст-сам-кубер}}`.
А так же Кубер создает метки с таким же хешом для `ReplicaSet` и для подов: `{{pod-template-hash}}: {{хэш}}`

Для того что бы `deployments` заставить обновлять приложение, именно секция `template` должна быть обновлена

---

В стратегии `RollingUpdate` обновление будет идти по очереди. Удаляются поды в количестве равным значению `maxUnavailable` и аналогично создается из значения `maxSurge`


![Дашборд](./%D0%BF%D0%BE-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D0%BD%D0%BE%D0%B5-%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D1%88%D0%B1%D0%BE%D1%80%D0%B4.jpg)

![Логи в терминале](%D0%BF%D0%BE-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D0%BD%D0%BE%D0%B5-%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%BE%D0%B4%D0%BE%D0%B2-%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB.jpg)
